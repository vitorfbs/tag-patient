<!DOCTYPE HTML>
<html>
    <head>
    <title>Controle de Paciente</title>
    
    </head>
    <body onload="wsConnect();" onunload="ws.disconnect();">
        <h1 id="name"></h1>
        <div id="rfid"></div>
        <div id="diagnostics"></div>
        <div id="history"></div>
        <hr>
        <div id="status"></div>
    </body>
    <script type="text/javascript">
        var ws;
        var wsUri = "ws://127.0.0.1:1880/ws/simple";
        var loc = window.location;
        console.log(loc);
        if (loc.protocol === "https:") { wsUri = "wss:"; }

        function wsConnect() {
            console.log("connect",wsUri);
            ws = new WebSocket(wsUri);
            ws.onmessage = function(msg) {
                var data = JSON.parse(msg.data);
                console.log(data);
                document.getElementById('rfid').innerHTML = data["rfid"];
                document.getElementById('name').innerHTML = data["name"];
                document.getElementById('diagnostics').innerHTML = data["diagnostics"];
                document.getElementById('history').innerHTML = data["history"];
            }
            ws.onopen = function() {
                document.getElementById('status').innerHTML = "connected";
                console.log("connected");
            }
            ws.onclose = function() {
                document.getElementById('status').innerHTML = "not connected";
                setTimeout(wsConnect,3000);
            }
        }
    </script>
</html>
